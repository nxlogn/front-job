{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../../softawres/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n\t<view class=\"login-container\">\r\n\t\t<!--顶部背景-->\r\n\t\t<view class=\"login-header\">\r\n\t\t\t<view class=\"header-content\">\r\n\t\t\t\t<image class=\"logo\" src=\"/static/logo.png\" mode=\"aspectFill\"></image>\r\n\t\t\t\t<text class=\"app-name\">哈基星球宠物服务</text>\r\n\t\t\t\t<text class=\"app-slogan\">让爱宠生活更美好</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!--登录表单-->\r\n\t\t<view class=\"login-form\">\r\n\t\t\t<!--微信小程序登录-->\r\n\t\t\t<view class=\"login-content\" v-if=\"platform==='mp-weixin'\">\r\n\t\t\t\t<view class=\"quick-login\">\r\n\t\t\t\t\t<text class=\"login-title\">手机号快捷登录</text>\r\n\t\t\t\t\t<text class=\"login-desc\">使用微信授权快捷登录</text>\r\n\t\t\t\t\t<!-- <button class=\"wechat-login-btn\"  open-type=\"getPhoneNumber\" @getphonenumber=\"getPhoneNumber\">\r\n\t\t\t\t\t\t<up-icon name=\"weixin-fill\" color=\"#fff\" size=\"32\" style=\"margin-right: 10rpx;\"></up-icon>\r\n\t\t\t\t\t\t微信获取手机号一键登录\r\n\t\t\t\t\t</button> -->\r\n\t\t\t\t\t<!--没有企业身份用这段代码登录，不影响后续流程-->\r\n\t\t\t\t\t<button class=\"wechat-login-btn\" @click=\"fn\">\r\n\t\t\t\t\t\t<up-icon name=\"weixin-fill\" color=\"#fff\" size=\"32\" style=\"margin-right: 10rpx;\"></up-icon>\r\n\t\t\t\t\t\t微信获取手机号一键登录\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!--h5 app-->\r\n\t\t\t<view v-else class=\"login-content\">\r\n\t\t\t\t<view class=\"phone-login\">\r\n\t\t\t\t\t<text class=\"login-title\">手机号登录</text>\r\n\t\t\t\t\t<text class=\"login-desc\">请输入手机号和验证码</text>\r\n\t\t\t\t\t<view class=\"input-group\">\r\n\t\t\t\t\t\t<view class=\"input-item\">\r\n\t\t\t\t\t\t\t<up-input placeholder=\"请输入手机号\" prefixIcon=\"phone\" border=\"none\"\r\n\t\t\t\t\t\t\t\tprefixIconStyle=\"font-size: 22px;color: #909399\" v-model=\"phone\"></up-input>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"input-item\">\r\n\t\t\t\t\t\t\t<up-input placeholder=\"请输入验证码\" type=\"number\" maxlength=\"6\" border=\"none\" prefixIcon=\"lock\"\r\n\t\t\t\t\t\t\t\tprefixIconStyle=\"font-size: 22px;color: #909399\" v-model=\"code\"></up-input>\r\n\t\t\t\t\t\t\t<view class=\"code-btn\" @click=\"getCode\">\r\n\t\t\t\t\t\t\t\t{{isCounting?countDown+\"s后重新获取\":\"获取验证码\"}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<up-button type=\"primary\" :custom-style=\"{\r\n\t\t\t\t\t\t\tbackgroundColor:'#ffce2c',\r\n\t\t\t\t\t\t\tborderColor:'#ffce2c',\r\n\t\t\t\t\t\t\theight:'88rpx',\r\n\t\t\t\t\t\t\tfontSize:'32rpx'\r\n\t\t\t\t\t\t}\" @click=\"handleLogin\">登录</up-button>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script setup lang=\"ts\">\r\n\timport { onMounted } from 'vue';\r\n\timport { ref } from 'vue';\r\n\timport { post } from \"../../utils/http\"\r\n\tconst platform = ref<string>(\"\")\r\n\tonMounted(() => {\r\n\r\n\t\tplatform.value = \"mp-weixin\"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t})\r\n\t//没有企业身份用这段代码模拟\r\n\tconst fn = () => {\r\n\t\tuni.setStorageSync(\"token\", \"xulaoshi666\")\r\n\t\tuni.setStorageSync(\"user\", { user_id: 1, phone: 18888888888 })\r\n\t\tuni.showToast({\r\n\t\t\ttitle: \"登陆成功\",\r\n\t\t\ticon: \"success\",\r\n\t\t\tduration: 1500\r\n\t\t})\r\n\t\tsetTimeout(() => {\r\n\t\t\tuni.navigateBack();\r\n\t\t}, 500)\r\n\t}\r\n\t//微信小程序一键登录\r\n\tconst getPhoneNumber = async (e) => {\r\n\t\tif (e.detail.errMsg === \"getPhoneNumber:ok\") {\r\n\t\t\ttry {\r\n\t\t\t\tconst phoneCode = e.detail.code //动态令牌 用来获取手机号 xulaoshi666 {user_id:1,phone:18888888888}\r\n\t\t\t\tconst res = await uni.login();\r\n\t\t\t\tconst loginCode = res.code //身份凭证，用来获取openid\r\n\t\t\t\tconst data : any = await post(\"/auth/wxLogin\", {\r\n\t\t\t\t\tloginCode,\r\n\t\t\t\t\tphoneCode,\r\n\t\t\t\t\tappid: \"你的企业appid\",//换成你的企业appid,\r\n\t\t\t\t\tsecret: \"你的企业小程序密钥\",//换成你的企业小程序密钥，密钥属于隐私数据，泄露会影响账号，所以不展示\r\n\t\t\t\t\t//如果你没有真实企业的id和密钥，可以来找徐老师，实名登记申请，徐老师会把密钥等借给你体验\r\n\t\t\t\t});\r\n\t\t\t\tuni.setStorageSync(\"token\", data.token)\r\n\t\t\t\tuni.setStorageSync(\"user\", data.user)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: \"登陆成功\",\r\n\t\t\t\t\ticon: \"success\",\r\n\t\t\t\t\tduration: 1500\r\n\t\t\t\t})\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.navigateBack();\r\n\t\t\t\t}, 500)\r\n\r\n\r\n\t\t\t} catch (error) {\r\n\t\t\t\t//TODO handle the exception\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: \"获取失败\",\r\n\t\t\t\ticon: \"error\"\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\t//手机号验证码登录\r\n\r\n\tconst phone = ref<string>(\"\")\r\n\tconst code = ref<string>(\"\")\r\n\t//倒计时相关\r\n\tconst countDown = ref<number>(60);\r\n\tconst isCounting = ref<boolean>(false)\r\n\r\n\tconst sendCode = async () => {\r\n\t\ttry {\r\n\t\t\tconst data : any = await post(\"/auth/sendSmsCode\", { phone: phone.value });\r\n\t\t\tuni.__f__('log','at pages/login/login.vue:138',\"验证码已发送\", data)\r\n\t\t} catch (error) {\r\n\t\t\tuni.__f__('log','at pages/login/login.vue:140',\"验证码发送失败\")\r\n\t\t}\r\n\t}\r\n\r\n\tconst getCode = () => {\r\n\t\tif (isCounting.value) return;\r\n\t\t//判断手机号格式\r\n\t\tconst phoneReg = /^1[3-9]\\d{9}$/;\r\n\t\tif (!phoneReg.test(phone.value)) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: \"请输入正确的手机号\",\r\n\t\t\t\ticon: \"none\"\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\t\tisCounting.value = true;\r\n\t\tcountDown.value = 60;\r\n\t\tconst timer = setInterval(() => {\r\n\t\t\tcountDown.value--\r\n\t\t\tif (countDown.value <= 0) {\r\n\t\t\t\tclearInterval(timer);\r\n\t\t\t\tisCounting.value = false;\r\n\t\t\t}\r\n\t\t}, 1000)\r\n\t\t//发送验证码\r\n\t\tsendCode()\r\n\t}\r\n\tconst handleLogin = async () => {\r\n\t\tconst phoneReg = /^1[3-9]\\d{9}$/;\r\n\t\tif (phoneReg.test(phone.value) && code.value) {\r\n\t\t\ttry {\r\n\t\t\t\tconst data : any = await post(\"/auth/verifySmsCode\", { phone: phone.value, code: code.value });\r\n\t\t\t\tuni.__f__('log','at pages/login/login.vue:172',\"登录结果\", data)\r\n\t\t\t\tuni.setStorageSync(\"token\", data.token)\r\n\t\t\t\tuni.setStorageSync(\"user\", data.user)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: \"登陆成功\",\r\n\t\t\t\t\ticon: \"success\",\r\n\t\t\t\t\tduration: 1500\r\n\t\t\t\t})\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.navigateBack();\r\n\t\t\t\t}, 500)\r\n\t\t\t} catch (error) {\r\n\t\t\t\tuni.__f__('log','at pages/login/login.vue:184',\"登录失败\")\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: \"请输入正确的信息\",\r\n\t\t\t\ticon: \"none\"\r\n\t\t\t})\r\n\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.login-container {\r\n\t\theight: 100vh;\r\n\t\tbackground: linear-gradient(135deg, #ffce2c 0%, #ffb347 100%);\r\n\r\n\t\t.login-header {\r\n\t\t\theight: 500rpx;\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tjustify-content: center;\r\n\r\n\t\t\t.header-content {\r\n\t\t\t\ttext-align: center;\r\n\r\n\t\t\t\t.logo {\r\n\t\t\t\t\twidth: 120rpx;\r\n\t\t\t\t\theight: 120rpx;\r\n\t\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.app-name {\r\n\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\tfont-size: 48rpx;\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tcolor: #fff;\r\n\t\t\t\t\tmargin-bottom: 10rpx;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.app-slogan {\r\n\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\tcolor: rgba(255, 255, 255, 0.8);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t.login-form {\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tborder-radius: 40rpx 40rpx 0 0;\r\n\t\t\tpadding: 60rpx 40rpx;\r\n\t\t\tmargin-top: -40rpx;\r\n\t\t\theight: calc(100vh - 580rpx);\r\n\r\n\t\t\t.login-content {\r\n\t\t\t\t.login-title {\r\n\t\t\t\t\tfont-size: 36rpx;\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.login-desc {\r\n\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\tmargin-bottom: 60rpx;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.wechat-login-btn {\r\n\t\t\t\t\tbackground-color: #07c160;\r\n\t\t\t\t\tcolor: #fff;\r\n\t\t\t\t\tborder: none;\r\n\t\t\t\t\tborder-radius: 16rpx;\r\n\t\t\t\t\theight: 88rpx;\r\n\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\tmargin-top: 60rpx;\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.input-group {\r\n\t\t\t\t\tmargin-bottom: 60rpx;\r\n\r\n\t\t\t\t\t.input-item {\r\n\t\t\t\t\t\tbackground-color: #f8f8f8;\r\n\t\t\t\t\t\tborder-radius: 16rpx;\r\n\t\t\t\t\t\tpadding: 30rpx 20rpx;\r\n\t\t\t\t\t\tmargin-bottom: 30rpx;\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\talign-items: center;\r\n\r\n\t\t\t\t\t\t.code-btn {\r\n\t\t\t\t\t\t\tpadding: 10rpx 20rpx;\r\n\t\t\t\t\t\t\tbackground-color: #ffce2c;\r\n\t\t\t\t\t\t\tcolor: #fff;\r\n\t\t\t\t\t\t\tborder-radius: 8rpx;\r\n\t\t\t\t\t\t\tfont-size: 24rpx;\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n</style>","import MiniProgramPage from 'D:/project/hakistar/hakistar/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni","post"],"mappings":";;;;;;;;;;;;;;;;;;;AA+DO,UAAA,WAAWA,kBAAY,EAAE;AAC/BC,kBAAAA,UAAU,MAAM;AAEf,eAAS,QAAQ;AAAA,IAAA,CAUjB;AAED,UAAM,KAAK,MAAM;AACZC,oBAAAA,MAAA,eAAe,SAAS,aAAa;AACzCA,0BAAI,eAAe,QAAQ,EAAE,SAAS,GAAG,OAAO,aAAa;AAC7DA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,MAAM;AAAA,QACN,UAAU;AAAA,MAAA,CACV;AACD,iBAAW,MAAM;AAChBA,sBAAA,MAAI,aAAa;AAAA,SACf,GAAG;AAAA,IAAA;AAwCD,UAAA,QAAQF,kBAAY,EAAE;AACtB,UAAA,OAAOA,kBAAY,EAAE;AAErB,UAAA,YAAYA,kBAAY,EAAE;AAC1B,UAAA,aAAaA,kBAAa,KAAK;AAErC,UAAM,WAAW,YAAY;AACxB,UAAA;AACG,cAAA,OAAa,MAAMG,iBAAAA,KAAK,qBAAqB,EAAE,OAAO,MAAM,OAAO;AACzED,sBAAA,MAAI,MAAM,OAAM,gCAA+B,UAAU,IAAI;AAAA,eACrD,OAAO;AACXA,sBAAAA,MAAA,MAAM,OAAM,gCAA+B,SAAS;AAAA,MACzD;AAAA,IAAA;AAGD,UAAM,UAAU,MAAM;AACrB,UAAI,WAAW;AAAO;AAEtB,YAAM,WAAW;AACjB,UAAI,CAAC,SAAS,KAAK,MAAM,KAAK,GAAG;AAChCA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AACD;AAAA,MACD;AACA,iBAAW,QAAQ;AACnB,gBAAU,QAAQ;AACZ,YAAA,QAAQ,YAAY,MAAM;AACrB,kBAAA;AACN,YAAA,UAAU,SAAS,GAAG;AACzB,wBAAc,KAAK;AACnB,qBAAW,QAAQ;AAAA,QACpB;AAAA,SACE,GAAI;AAEE;IAAA;AAEV,UAAM,cAAc,YAAY;AAC/B,YAAM,WAAW;AACjB,UAAI,SAAS,KAAK,MAAM,KAAK,KAAK,KAAK,OAAO;AACzC,YAAA;AACG,gBAAA,OAAa,MAAMC,sBAAK,uBAAuB,EAAE,OAAO,MAAM,OAAO,MAAM,KAAK,MAAO,CAAA;AAC7FD,wBAAA,MAAI,MAAM,OAAM,gCAA+B,QAAQ,IAAI;AACvDA,wBAAAA,MAAA,eAAe,SAAS,KAAK,KAAK;AAClCA,wBAAAA,MAAA,eAAe,QAAQ,KAAK,IAAI;AACpCA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,YACN,UAAU;AAAA,UAAA,CACV;AACD,qBAAW,MAAM;AAChBA,0BAAA,MAAI,aAAa;AAAA,aACf,GAAG;AAAA,iBACE,OAAO;AACXA,wBAAAA,MAAA,MAAM,OAAM,gCAA+B,MAAM;AAAA,QACtD;AAAA,MAAA,OACM;AACNA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AAAA,MAEF;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9LF,GAAG,WAAW,eAAe;"}