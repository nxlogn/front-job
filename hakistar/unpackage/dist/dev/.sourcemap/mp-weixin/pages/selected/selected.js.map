{"version":3,"file":"selected.js","sources":["pages/selected/selected.vue","../../../softawres/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VsZWN0ZWQvc2VsZWN0ZWQudnVl"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<view class=\"header\">\r\n\t\t\t<view class=\"nav-content\">\r\n\t\t\t\t<uni-search-bar radius=\"100\" placeholder=\"猫粮狗粮、宠物零食\" clearButton=\"none\" cancelButton=\"none\"\r\n\t\t\t\t\tstyle=\"width: 100%;\">\r\n\t\t\t\t</uni-search-bar>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<view class=\"content\">\r\n\t\t\t<view class=\"category-section\">\r\n\t\t\t\t<!--左侧分类-->\r\n\t\t\t\t<scroll-view class=\"category-left\" scroll-y>\r\n\t\t\t\t\t<view \r\n\t\t\t\t\t\tv-for=\"(item,index) in categories\" \r\n\t\t\t\t\t\t:key=\"item.id\" \r\n\t\t\t\t\t\tclass=\"category-item\"\r\n\t\t\t\t\t\t:class=\"{active:currentCategory===index}\"\r\n\t\t\t\t\t\t@click=\"swtichCategory(index,item.id)\"\r\n\t\t\t\t\t>{{item.category_name}}</view>\r\n\t\t\t\t</scroll-view>\r\n\t\t\t\t\r\n\t\t\t\t<!--右侧商品-->\r\n\t\t\t\t<scroll-view scroll-y class=\"category-right\">\r\n\t\t\t\t\t<view class=\"category-title\">{{categories.length>0?categories[currentCategory].category_name:\"暂无数据\"}}</view>\r\n\t\t\t\t\t<view class=\"product-list\">\r\n\t\t\t\t\t\t<view class=\"product-item\" v-for=\"item in products\" :key=\"item.id\">\r\n\t\t\t\t\t\t\t<image :src=\"item.main_pic\" mode=\"aspectFill\" class=\"product-image\" @click=\"goProductDetail(item)\"></image>\r\n\t\t\t\t\t\t\t<view class=\"product-info\">\r\n\t\t\t\t\t\t\t\t<text class=\"product-name\">{{item.name}}</text>\r\n\t\t\t\t\t\t\t\t<view class=\"price-row\">\r\n\t\t\t\t\t\t\t\t\t<text class=\"product-price\">￥{{item.price}}</text>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<view class=\"add-cart\" @click=\"addCart(item)\">\r\n\t\t\t\t\t\t\t\t\t\t<up-icon name=\"shopping-cart\" color=\"#fff\" size=\"18\"></up-icon>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</scroll-view>\r\n\t\t\t</view>\r\n\t\t</view>\n\t</view>\r\n\t<view class=\"float-cart\" @click=\"goCart\">\r\n\t\t<up-icon name=\"shopping-cart\" color=\"#ffce2c\" size=\"80rpx\"></up-icon>\r\n\t\t<view class=\"cart-badge\" v-if=\"cartCount>0\">{{cartCount}}</view>\r\n\t</view>\r\n\t<ProductSpecPopup :show=\"show\" :product=\"selProduct\" @close=\"handleClose\" :showOk=\"false\"/>\n</template>\n\n<script setup lang=\"ts\">\r\nimport { get } from '../../utils/http';\r\nimport {onLoad,onReachBottom,onShow} from \"@dcloudio/uni-app\"\r\nimport { ref } from 'vue';\r\nimport ProductSpecPopup from '../../components/products-spec-popup/product-spec-popup.vue';\r\nonLoad(()=>{\r\n\tgetCategories();\r\n})\r\nonShow(()=>{\r\n\tgetCartCount()\r\n})\r\n\r\ninterface CategoryItem{\r\n\tid:number;\r\n\tcategory_name:string\r\n}\r\ninterface ProductItem{\r\n\tid:number;\r\n\tname:string;\r\n\tprice:string;\r\n\to_price:string;\r\n\tstock:number;\r\n\tcategory_id:number;\r\n\tmain_pic:string;\r\n\tdesc:string\r\n}\r\n//获取左侧菜单分类\r\nconst currentPage=ref<number>(1);\r\nconst categories=ref<CategoryItem[]>([])\r\nconst getCategories=async ()=>{\r\n\ttry {\r\n\t\tconst data:any=await get(\"/sel/tag\");\r\n\t\tcategories.value=data.tag;\r\n\t\tgetProducts(currentPage.value,categories.value[0].id)\r\n\t} catch (error) {\r\n\t\tuni.__f__('error','at pages/selected/selected.vue:88',\"获取失败\")\r\n\t}\r\n}\r\n//获取商品列表\r\nconst products=ref<ProductItem[]>([])\r\nconst totalPages=ref<number>(0)\r\nconst getProducts=async(page:number,category_id:number)=>{\r\n\ttry {\r\n\t\tconst data:any=await get(\"/sel/products\",{page,category_id})\r\n\t\tif(page==1){\r\n\t\t\tproducts.value=data.list;\r\n\t\t}else{\r\n\t\t\tproducts.value=[...products.value,...data.list]\r\n\t\t}\r\n\t\ttotalPages.value=data.pagination.totalPages\r\n\t\tcurrentPage.value=page\r\n\t} catch (error) {\r\n\t\tuni.__f__('error','at pages/selected/selected.vue:105',error)\r\n\t}\r\n}\r\n\r\n//设置高亮效果\r\nconst currentCategory=ref<number>(0)\nconst swtichCategory=(index:number,category_id:number)=>{\r\n\tcurrentCategory.value=index;\r\n\tcurrentPage.value=1;\r\n\tproducts.value=[]\r\n\tgetProducts(currentPage.value,category_id)\r\n}\r\n\r\nonReachBottom(()=>{\r\n\tuni.__f__('log','at pages/selected/selected.vue:119',\"触底了\");\r\n\tif(currentPage.value<totalPages.value){\r\n\t\tgetProducts(currentPage.value+1,categories.value[currentCategory.value].id)\r\n\t}\r\n})\r\n//购物车\r\nconst cartCount=ref<number>(0)\r\nconst getCartCount=async()=>{\r\n\ttry {\r\n\t\tconst data:any=await get(\"/cart/list\")\r\n\t\tcartCount.value=data.length\r\n\t} catch (error) {\r\n\t\t//TODO handle the exception\r\n\t}\r\n}\r\n\r\nconst goCart=()=>{\r\n\t//判断用户是否登录，如果未登录，应跳转到登录页\r\n\tconst token=uni.getStorageSync(\"token\");\r\n\tif(!token){\r\n\t\tuni.navigateTo({\r\n\t\t\turl:\"/pages/login/login\"\r\n\t\t})\r\n\t\treturn\r\n\t}\r\n\tuni.navigateTo({\r\n\t\turl:\"/pages/cart/cart\"\r\n\t})\r\n}\r\n\r\n//规格弹窗\r\nconst show=ref<boolean>(false)\r\nconst selProduct=ref<ProductItem>({} as ProductItem)\r\nconst addCart=(product:ProductItem)=>{\r\n\tshow.value=true;\r\n\tselProduct.value=product\r\n\r\n}\r\n\r\nconst handleClose=()=>{\r\n\tshow.value=false\r\n\tgetCartCount()\t\r\n}\r\n\r\n//跳转到详情页\r\nconst goProductDetail=(product:ProductItem)=>{\r\n\tuni.navigateTo({\r\n\t\turl:`/packageA/product-detail/product-detail?product=${JSON.stringify(product)}`\r\n\t})\r\n}\n</script>\n\n<style lang=\"scss\" scoped>\n\t  .container{\r\n\t\t  background-color: #f7f7f7;\r\n\t\t  .header{\r\n\t\t\t  background-color: $uni-color-primary;\r\n\t\t\t  width: 100%;\r\n\t\t\t  .nav-content{\r\n\t\t\t\t  height:88rpx;\r\n\t\t\t\t  display: flex;\r\n\t\t\t\t  align-items: center;\r\n\t\t\t\t  padding: 30rpx 50rpx;\r\n\t\t\t  }\r\n\t\t  }\r\n\t\t  .content{\r\n\t\t\t  .category-section{\r\n\t\t\t\t  background-color: #fff;\r\n\t\t\t\t  border-radius: 16rpx;\r\n\t\t\t\t  height: calc(100vh - 150rpx);\r\n\t\t\t\t  display: flex;\r\n\t\t\t\t  .category-left{\r\n\t\t\t\t\t  width: 180rpx;\r\n\t\t\t\t\t  height: 100%;\r\n\t\t\t\t\t  background-color: #f7f7f7;\r\n\t\t\t\t\t  .category-item{\r\n\t\t\t\t\t\t  height: 100rpx;\r\n\t\t\t\t\t\t  line-height: 100rpx;\r\n\t\t\t\t\t\t  text-align: center;\r\n\t\t\t\t\t\t  font-size: 28rpx;\r\n\t\t\t\t\t\t  color: $uni-text-color;\r\n\t\t\t\t\t\t  border-bottom:1px solid #eee;\r\n\t\t\t\t\t\t  position: relative;\r\n\t\t\t\t\t\t  &.active{\r\n\t\t\t\t\t\t\t  background-color: #fff;\r\n\t\t\t\t\t\t\t  color:$uni-color-primary;\r\n\t\t\t\t\t\t\t  font-weight: bold;\r\n\t\t\t\t\t\t\t  &::before{\r\n\t\t\t\t\t\t\t\t  content: \"\";\r\n\t\t\t\t\t\t\t\t  position: absolute;\r\n\t\t\t\t\t\t\t\t  width: 6rpx;\r\n\t\t\t\t\t\t\t\t  height: 36rpx;\r\n\t\t\t\t\t\t\t\t  left: 0;\r\n\t\t\t\t\t\t\t\t  top:50%;\r\n\t\t\t\t\t\t\t\t  transform: translateY(-50%);\r\n\t\t\t\t\t\t\t\t  background-color:$uni-color-primary ;\r\n\t\t\t\t\t\t\t\t  border-radius: 0 4rpx 4rpx 0; \r\n\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t  \r\n\t\t\t\t\t\t  }\r\n\t\t\t\t\t  }\r\n\t\t\t\t  }\r\n\t\t\t\t  .category-right{\r\n\t\t\t\t\t  flex: 1;\r\n\t\t\t\t\t  height: 100%;\r\n\t\t\t\t\t  padding: 20rpx;\r\n\t\t\t\t\t  .category-title{\r\n\t\t\t\t\t\t  font-size: 32rpx;\r\n\t\t\t\t\t\t  font-weight: bold;\r\n\t\t\t\t\t\t  margin-bottom: 20rpx;\r\n\t\t\t\t\t\t  padding: 0 10rpx;\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t  .product-list{\r\n\t\t\t\t\t\t  display: flex;\r\n\t\t\t\t\t\t  flex-wrap: wrap;\r\n\t\t\t\t\t\t  .product-item{\r\n\t\t\t\t\t\t\t  width: calc(50% - 20rpx);\r\n\t\t\t\t\t\t\t  margin: 10rpx;\r\n\t\t\t\t\t\t\t  padding: 10rpx;\r\n\t\t\t\t\t\t\t  box-sizing: border-box;\r\n\t\t\t\t\t\t\t  border-radius: 12rpx;\r\n\t\t\t\t\t\t\t  overflow: hidden;\r\n\t\t\t\t\t\t\t  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.2);\r\n\t\t\t\t\t\t\t.product-image{\r\n\t\t\t\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\t\t\t\theight: 200rpx;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t.product-info{\r\n\t\t\t\t\t\t\t\tpadding: 16rpx;\r\n\t\t\t\t\t\t\t\t.product-name{\r\n\t\t\t\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\t\t\t\t\tmargin-bottom:8rpx;\r\n\t\t\t\t\t\t\t\t\twhite-space: nowrap;\r\n\t\t\t\t\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t\t\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\t\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\t\t\t\t\tline-height: 1.4;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t.price-row{\r\n\t\t\t\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\t\t\t\tjustify-content: space-around;\r\n\t\t\t\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\t\t\t\t.product-price{\r\n\t\t\t\t\t\t\t\t\t\tfont-size: 26rpx;\r\n\t\t\t\t\t\t\t\t\t\tcolor:$uni-color-primary;\r\n\t\t\t\t\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t.add-cart{\r\n\t\t\t\t\t\t\t\t\t\twidth:48rpx;\r\n\t\t\t\t\t\t\t\t\t\theight: 48rpx;\r\n\t\t\t\t\t\t\t\t\t\tbackground-color:$uni-color-primary ;\r\n\t\t\t\t\t\t\t\t\t\tborder-radius: 50%;\r\n\t\t\t\t\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t  }\r\n\t\t\t\t\t  }\r\n\t\t\t\t  }\r\n\t\t\t  }\r\n\t\t  }\r\n\t  }     \n\r\n\t.float-cart{\r\n\t\tposition: fixed;\r\n\t\tright: 30rpx;\r\n\t\tbottom: 100rpx;\r\n\t\twidth: 100rpx;\r\n\t\theight: 100rpx;\r\n\t\tborder-radius: 50%;\r\n\t\tbackground-color: white;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tbox-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.2);\r\n\t\tz-index: 999;\r\n\t\t.cart-badge{\r\n\t\t\tposition: absolute;\r\n\t\t\ttop: -6rpx;\r\n\t\t\tright: -6rpx;\r\n\t\t\tbackground-color: #ff4d4f;\r\n\t\t\tcolor: #fff;\r\n\t\t\tfont-size: 24rpx;\r\n\t\t\twidth: 36rpx;\r\n\t\t\theight: 36rpx;\r\n\t\t\tborder-radius: 50%;\r\n\t\t\tline-height: 36rpx;\r\n\t\t\ttext-align: center;\r\n\t\t\tpadding: 6rpx;\r\n\t\t}\r\n\t}\r\n</style>\n","import MiniProgramPage from 'D:/project/hakistar/hakistar/pages/selected/selected.vue'\nwx.createPage(MiniProgramPage)"],"names":["onLoad","onShow","ref","get","uni","onReachBottom"],"mappings":";;;;;;;;;;;;;AAwDA,MAAA,mBAA6B,MAAA;;;;AAC7BA,kBAAAA,OAAO,MAAI;AACI;IAAA,CACd;AACDC,kBAAAA,OAAO,MAAI;AACG;IAAA,CACb;AAiBK,UAAA,cAAYC,kBAAY,CAAC;AACzB,UAAA,aAAWA,kBAAoB,CAAA,CAAE;AACvC,UAAM,gBAAc,YAAU;AACzB,UAAA;AACG,cAAA,OAAS,MAAMC,qBAAI,UAAU;AACnC,mBAAW,QAAM,KAAK;AACtB,oBAAY,YAAY,OAAM,WAAW,MAAM,CAAC,EAAE,EAAE;AAAA,eAC5C,OAAO;AACXC,sBAAAA,MAAA,MAAM,SAAQ,qCAAoC,MAAM;AAAA,MAC7D;AAAA,IAAA;AAGK,UAAA,WAASF,kBAAmB,CAAA,CAAE;AAC9B,UAAA,aAAWA,kBAAY,CAAC;AACxB,UAAA,cAAY,OAAM,MAAY,gBAAqB;AACpD,UAAA;AACH,cAAM,OAAS,MAAMC,qBAAI,iBAAgB,EAAC,MAAK,aAAY;AAC3D,YAAG,QAAM,GAAE;AACV,mBAAS,QAAM,KAAK;AAAA,QAAA,OAChB;AACJ,mBAAS,QAAM,CAAC,GAAG,SAAS,OAAM,GAAG,KAAK,IAAI;AAAA,QAC/C;AACW,mBAAA,QAAM,KAAK,WAAW;AACjC,oBAAY,QAAM;AAAA,eACV,OAAO;AACXC,sBAAAA,MAAA,MAAM,SAAQ,sCAAqC,KAAK;AAAA,MAC7D;AAAA,IAAA;AAIK,UAAA,kBAAgBF,kBAAY,CAAC;AAC7B,UAAA,iBAAe,CAAC,OAAa,gBAAqB;AACvD,sBAAgB,QAAM;AACtB,kBAAY,QAAM;AAClB,eAAS,QAAM;AACH,kBAAA,YAAY,OAAM,WAAW;AAAA,IAAA;AAG1CG,kBAAAA,cAAc,MAAI;AACbD,oBAAAA,MAAA,MAAM,OAAM,sCAAqC,KAAK;AACvD,UAAA,YAAY,QAAM,WAAW,OAAM;AACzB,oBAAA,YAAY,QAAM,GAAE,WAAW,MAAM,gBAAgB,KAAK,EAAE,EAAE;AAAA,MAC3E;AAAA,IAAA,CACA;AAEK,UAAA,YAAUF,kBAAY,CAAC;AAC7B,UAAM,eAAa,YAAS;AACvB,UAAA;AACG,cAAA,OAAS,MAAMC,qBAAI,YAAY;AACrC,kBAAU,QAAM,KAAK;AAAA,eACb,OAAO;AAAA,MAEhB;AAAA,IAAA;AAGD,UAAM,SAAO,MAAI;AAEV,YAAA,QAAMC,cAAAA,MAAI,eAAe,OAAO;AACtC,UAAG,CAAC,OAAM;AACTA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAI;AAAA,QAAA,CACJ;AACD;AAAA,MACD;AACAA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAI;AAAA,MAAA,CACJ;AAAA,IAAA;AAII,UAAA,OAAKF,kBAAa,KAAK;AACvB,UAAA,aAAWA,kBAAiB,CAAA,CAAiB;AAC7C,UAAA,UAAQ,CAAC,YAAsB;AACpC,WAAK,QAAM;AACX,iBAAW,QAAM;AAAA,IAAA;AAIlB,UAAM,cAAY,MAAI;AACrB,WAAK,QAAM;AACE;IAAA;AAIR,UAAA,kBAAgB,CAAC,YAAsB;AAC5CE,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAI,mDAAmD,KAAK,UAAU,OAAO,CAAC;AAAA,MAAA,CAC9E;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrKF,GAAG,WAAW,eAAe;"}