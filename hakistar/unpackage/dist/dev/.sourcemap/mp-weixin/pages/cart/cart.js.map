{"version":3,"file":"cart.js","sources":["pages/cart/cart.vue","../../../softawres/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2FydC9jYXJ0LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"cart-container\">\r\n\t\t<view class=\"cart-list\" v-if=\"cartList.length>0\">\r\n\t\t\t<view class=\"cart-item\" v-for=\"item in cartList\" :key=\"item.cart_id\">\r\n\t\t\t\t<view class=\"checkbox\">\r\n\t\t\t\t\t<up-checkbox usedAlone v-model:checked=\"item.selected\"></up-checkbox>\r\n\t\t\t\t</view>\r\n\t\t\t\t<image class=\"product-img\" :src=\"item.main_pic\" mode=\"aspectFill\"></image>\r\n\t\t\t\t<view class=\"product-info\">\r\n\t\t\t\t\t<view class=\"product-name\">{{item.name}}</view>\r\n\t\t\t\t\t<view class=\"product-spec\">{{item.spec}}</view>\r\n\t\t\t\t\t<view class=\"price-quantity\">\r\n\t\t\t\t\t\t<view class=\"price\">￥{{item.price}}</view>\r\n\t\t\t\t\t\t<view class=\"quantity-control\">\r\n\t\t\t\t\t\t\t<text class=\"quantity-label\">数量：</text>\r\n\t\t\t\t\t\t\t<view class=\"quantity-text\">{{item.count}}</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"delete-btn\" @click=\"deleteItem(item.cart_id)\">\r\n\t\t\t\t\t<up-icon name=\"trash\" size=\"20\" color=\"#999\"></up-icon>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!--空购物车-->\r\n\t\t<view class=\"empty-cart\" v-else>\r\n\t\t\t<view class=\"empty-text\">购物车空空如也~</view>\r\n\t\t\t<view class=\"go-shopping\">去逛逛!</view>\r\n\t\t</view>\r\n\t\t<!--底部结算栏-->\r\n\t\t<view class=\"settlement-bar\">\r\n\t\t\t<view class=\"select-all\">\r\n\t\t\t\t<up-checkbox usedAlone  v-model:checked=\"allChecked\" @change=\"toggleAllChecked\"></up-checkbox>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"total-info\">\r\n\t\t\t\t<view class=\"total-price\">\r\n\t\t\t\t\t合计：<text class=\"price\">￥{{totalPrice}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"total-desc\">不含运费</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"settle-btn\" :class=\"{active:selectedCount>0}\" @click=\"goOrder\">结算({{selectedCount}})</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script lang=\"ts\" setup>\r\n\timport { ref, computed, watch} from 'vue'\r\n\timport { get,post } from '../../utils/http'\r\n\timport { onLoad } from \"@dcloudio/uni-app\"\r\n\tonLoad(() => {\r\n\t\tgetCart()\r\n\t})\r\n\tinterface cartItem {\r\n\t\tcart_id : number;\r\n\t\tcount : number;\r\n\t\tmain_pic : string;\r\n\t\tname : string;\r\n\t\tprice : string;\r\n\t\tproduct_id : number;\r\n\t\tspec : string;\r\n\t\tuser_id : number\r\n\t\tselected : boolean\r\n\t}\r\n\t//购物车数据\r\n\tconst cartList = ref<cartItem[]>([])\r\n\tconst getCart = async () => {\r\n\t\ttry {\r\n\t\t\tconst data : any = await get(\"/cart/list\")\r\n\t\t\tuni.__f__('log','at pages/cart/cart.vue:69',\"购物车数据\", data)\r\n\t\t\tcartList.value = data.map(item => ({\r\n\t\t\t\t...item,\r\n\t\t\t\tselected: false\r\n\t\t\t}))\r\n\t\t} catch (error) {\r\n\t\t\t//TODO handle the exception\r\n\t\t\tuni.__f__('error','at pages/cart/cart.vue:76',\"获取失败\")\r\n\t\t}\r\n\t}\r\n\t//计算总价\r\n\tconst totalPrice = computed<string>(() => {\r\n\t\tlet total : number = 0;\r\n\t\tfor (const item of cartList.value) {\r\n\t\t\tif (item.selected) {\r\n\t\t\t\ttotal += Number(item.price)\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn total.toFixed(2)\r\n\t})\r\n\t//计算选中商品数量\r\n\tconst selectedCount = computed<number>(() => {\r\n\t\treturn cartList.value.filter(item => item.selected).length\r\n\t})\r\n\t//全选功能\r\n\tconst allChecked=ref<boolean>(false);\r\n\twatch(cartList,()=>{\r\n\t\t//cartList数组，里面嵌套对象 默认浅层监听\r\n\t\t//如果购物车数据为空的话，不做判断直接为false\r\n\t\tif(cartList.value.length===0){\r\n\t\t\tallChecked.value=false;\r\n\t\t\treturn\r\n\t\t}\r\n\t\tallChecked.value=cartList.value.length===selectedCount.value\r\n\t},{\r\n\t\tdeep:true\r\n\t})\r\n\tconst toggleAllChecked=()=>{\r\n\t\tcartList.value.forEach(item=>{\r\n\t\t\titem.selected=!allChecked.value\r\n\t\t})\r\n\t}\r\n\t//删除购物车数据\r\n\tconst deleteItem=(cart_id:number)=>{\r\n\t\tuni.showModal({\r\n\t\t\ttitle:\"提示\",\r\n\t\t\tcontent:\"确定要删除此商品吗?\",\r\n\t\t\tsuccess:async (res) =>{\r\n\t\t\t\tif(res.confirm){\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tawait post(\"/cart/deleteCart\",{cart_id})\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle:\"删除成功\",\r\n\t\t\t\t\t\t\ticon:\"success\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tgetCart();\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tuni.__f__('error','at pages/cart/cart.vue:126',\"删除商品失败\")\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t\r\n\tconst selPro=computed<cartItem[]>(()=>{\r\n\t\treturn cartList.value.filter(item=>item.selected)\r\n\t})\r\n\t\r\n\tconst goOrder=()=>{\r\n\t\tif(selectedCount.value){\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl:\"/packageB/order/order?selPro=\"+JSON.stringify(selPro.value)\r\n\t\t\t})\r\n\t\t}\t\r\n\t}\r\n\t\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n\t.cart-container {\r\n\t\tbackground-color: #f8f8f8;\r\n\t\tpadding-bottom: 100rpx;\r\n\t\tmin-height: 100vh;\r\n\r\n\t\t.cart-list {\r\n\t\t\tpadding: 20rpx;\r\n\r\n\t\t\t.cart-item {\r\n\t\t\t\tbackground-color: #fff;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tpadding: 20rpx;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\tborder-radius: 12rpx;\r\n\r\n\t\t\t\t.checkbox {\r\n\t\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.product-img {\r\n\t\t\t\t\twidth: 160rpx;\r\n\t\t\t\t\theight: 160rpx;\r\n\t\t\t\t\tborder-radius: 8rpx;\r\n\t\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.product-info {\r\n\t\t\t\t\tflex: 1;\r\n\r\n\t\t\t\t\t.product-name {\r\n\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\tmargin-bottom: 10rpx;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.product-spec {\r\n\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.price-quantity {\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\t\talign-items: center;\r\n\r\n\t\t\t\t\t\t.price {\r\n\t\t\t\t\t\t\tcolor: #ff4d4f;\r\n\t\t\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.quantity-control {\r\n\t\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\t\talign-items: center;\r\n\r\n\t\t\t\t\t\t\t.quantity-label {\r\n\t\t\t\t\t\t\t\tfont-size: 26rpx;\r\n\t\t\t\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\t\t\t\tmargin-right: 10rpx;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t.quantity-text {\r\n\t\t\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\t\t\tbackground-color: #f5f5f5;\r\n\t\t\t\t\t\t\t\tpadding: 4rpx 20rpx;\r\n\t\t\t\t\t\t\t\tborder-radius: 6rpx;\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.delete-btn {\r\n\t\t\t\t\tpadding: 20rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.empty-cart {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding-top: 200rpx;\r\n\r\n\t\t\t.empty-text {\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t\tmargin-bottom: 40rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.go-shopping {\r\n\t\t\t\twidth: 240rpx;\r\n\t\t\t\theight: 80rpx;\r\n\t\t\t\tbackground-color: #ffce2c;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tborder-radius: 40rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tline-height: 80rpx;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.settlement-bar {\r\n\t\t\tposition: fixed;\r\n\t\t\tbottom: 0;\r\n\t\t\tleft: 0;\r\n\t\t\tright: 0;\r\n\t\t\theight: 100rpx;\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding: 0 20rpx;\r\n\t\t\tbox-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.05);\r\n\r\n\t\t\t.select-all {\r\n\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.total-info {\r\n\t\t\t\tflex: 1;\r\n\r\n\t\t\t\t.total-price {\r\n\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\tcolor: #333;\r\n\r\n\t\t\t\t\t.price {\r\n\t\t\t\t\t\tcolor: #ff4d4f;\r\n\t\t\t\t\t\tfont-size: 36rpx;\r\n\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.total-desc {\r\n\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\tcolor: #999;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.settle-btn {\r\n\t\t\t\twidth: 200rpx;\r\n\t\t\t\theight: 80rpx;\r\n\t\t\t\tbackground-color: #ddd;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tborder-radius: 40rpx;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tline-height: 80rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\r\n\t\t\t\t&.active {\r\n\r\n\t\t\t\t\tbackground-color: #ffce2c !important;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>","import MiniProgramPage from 'D:/project/hakistar/hakistar/pages/cart/cart.vue'\nwx.createPage(MiniProgramPage)"],"names":["onLoad","ref","get","uni","computed","watch","post"],"mappings":";;;;;;;;;;;;;;;;AAiDCA,kBAAAA,OAAO,MAAM;AACJ;IAAA,CACR;AAaK,UAAA,WAAWC,kBAAgB,CAAA,CAAE;AACnC,UAAM,UAAU,YAAY;AACvB,UAAA;AACG,cAAA,OAAa,MAAMC,qBAAI,YAAY;AACzCC,sBAAA,MAAI,MAAM,OAAM,6BAA4B,SAAS,IAAI;AAChD,iBAAA,QAAQ,KAAK,IAAI,CAAS,UAAA;AAAA,UAClC,GAAG;AAAA,UACH,UAAU;AAAA,QACT,EAAA;AAAA,eACM,OAAO;AAEXA,sBAAAA,MAAA,MAAM,SAAQ,6BAA4B,MAAM;AAAA,MACrD;AAAA,IAAA;AAGK,UAAA,aAAaC,cAAAA,SAAiB,MAAM;AACzC,UAAI,QAAiB;AACV,iBAAA,QAAQ,SAAS,OAAO;AAClC,YAAI,KAAK,UAAU;AACT,mBAAA,OAAO,KAAK,KAAK;AAAA,QAC3B;AAAA,MACD;AACO,aAAA,MAAM,QAAQ,CAAC;AAAA,IAAA,CACtB;AAEK,UAAA,gBAAgBA,cAAAA,SAAiB,MAAM;AAC5C,aAAO,SAAS,MAAM,OAAO,CAAQ,SAAA,KAAK,QAAQ,EAAE;AAAA,IAAA,CACpD;AAEK,UAAA,aAAWH,kBAAa,KAAK;AACnCI,kBAAA,MAAM,UAAS,MAAI;AAGf,UAAA,SAAS,MAAM,WAAS,GAAE;AAC5B,mBAAW,QAAM;AACjB;AAAA,MACD;AACA,iBAAW,QAAM,SAAS,MAAM,WAAS,cAAc;AAAA,IAAA,GACtD;AAAA,MACD,MAAK;AAAA,IAAA,CACL;AACD,UAAM,mBAAiB,MAAI;AACjB,eAAA,MAAM,QAAQ,CAAM,SAAA;AACvB,aAAA,WAAS,CAAC,WAAW;AAAA,MAAA,CAC1B;AAAA,IAAA;AAGI,UAAA,aAAW,CAAC,YAAiB;AAClCF,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAM;AAAA,QACN,SAAQ;AAAA,QACR,SAAQ,OAAO,QAAO;AACrB,cAAG,IAAI,SAAQ;AACV,gBAAA;AACH,oBAAMG,sBAAK,oBAAmB,EAAC,QAAQ,CAAA;AACvCH,4BAAAA,MAAI,UAAU;AAAA,gBACb,OAAM;AAAA,gBACN,MAAK;AAAA,cAAA,CACL;AACO;qBACA,OAAO;AACXA,4BAAAA,MAAA,MAAM,SAAQ,8BAA6B,QAAQ;AAAA,YACxD;AAAA,UACD;AAAA,QACD;AAAA,MAAA,CACA;AAAA,IAAA;AAGI,UAAA,SAAOC,cAAAA,SAAqB,MAAI;AACrC,aAAO,SAAS,MAAM,OAAO,CAAA,SAAM,KAAK,QAAQ;AAAA,IAAA,CAChD;AAED,UAAM,UAAQ,MAAI;AACjB,UAAG,cAAc,OAAM;AACtBD,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAI,kCAAgC,KAAK,UAAU,OAAO,KAAK;AAAA,QAAA,CAC/D;AAAA,MACF;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5IF,GAAG,WAAW,eAAe;"}