import{a4 as e,a,d as s,W as t,a5 as l,c,e as u,f as o,h as n,i,w as r,j as p,k as d,t as v,l as _,m as f,F as m,D as h,V as k,u as y,p as g,q as C,a6 as w,I as b,z as j,B as O}from"./index-HfrO64ci.js";import{p as x,g as S}from"./index.qscmTMIl.js";const T=e("spec",(()=>{const e=a(""),s=a(1),t=a(0);return{specText:e,setSpec:function(a){e.value=a},count:s,setCount:function(e){s.value=e},total:t,setTotal:function(e){t.value=e}}})),q=O(s({__name:"product-spec-popup",props:{show:{type:Boolean},product:{},showOk:{type:Boolean}},emits:["close"],setup(e,{emit:s}){const O=T(),q=e,B=s;t((()=>q.show),(e=>{e&&F()}));const E=a([]),F=async()=>{try{const e=await S("/cart/getSpec",{id:q.product.id});E.value=e||[],e||(D(),setTimeout((()=>{j({url:"/pages/login/login"})}),500))}catch(e){console.log(e)}},I=l({}),N=l({}),z=a(""),D=()=>{B("close"),Object.keys(I).forEach((e=>delete I[e])),Object.keys(N).forEach((e=>delete N[e])),z.value=""},P=a(1),V=()=>{P.value++},W=()=>{P.value>1&&P.value--},A=c((()=>{let e=Number(q.product.price);return E.value.length&&E.value.forEach((a=>{const s=a.values.find((e=>I[a.attr_id]===e.value_id));console.log("选中的数据",s),(null==s?void 0:s.multiple)&&(e*=Number(s.multiple))})),e*P.value})),G=async()=>{if(E.value.every((e=>I[e.attr_id])))try{await x("/cart/addCart",{product_id:q.product.id,name:q.product.name,price:A.value,count:P.value,spec:z.value,main_pic:q.product.main_pic});k({title:"加购成功",icon:"success"}),O.setSpec(""),O.setCount(1),D()}catch(e){console.error(e)}else k({title:"请选择完整规格",icon:"error"})},H=()=>{E.value.every((e=>I[e.attr_id]))?(O.setSpec(z.value),O.setCount(P.value),O.setTotal(A.value),D()):k({title:"请选择完整规格",icon:"error"})};return(e,a)=>{const s=y,t=g,l=C,c=u(o("up-popup"),w);return n(),i(c,{show:e.show,closeable:"",onClose:D},{default:r((()=>[p(t,{class:"spec-popup"},{default:r((()=>[p(t,{class:"popup-header"},{default:r((()=>[p(s,{class:"product-img",src:e.product.main_pic,mode:"aspectFill"},null,8,["src"]),p(t,{class:"product-info"},{default:r((()=>[p(t,{class:"price"},{default:r((()=>[d("￥"+v(A.value),1)])),_:1}),p(t,{class:"selected"},{default:r((()=>[d("已选："+v(z.value||"请选择规格"),1)])),_:1})])),_:1})])),_:1}),p(t,{class:"spec-content"},{default:r((()=>[(n(!0),_(m,null,f(E.value,(e=>(n(),i(t,{class:"spec-group",key:e.attr_id},{default:r((()=>[p(t,{class:"group-title"},{default:r((()=>[d(v(e.attr_name),1)])),_:2},1024),p(t,{class:"spec-items"},{default:r((()=>[(n(!0),_(m,null,f(e.values,((a,s)=>(n(),i(t,{class:b(["spec-item",{active:I[e.attr_id]===a.value_id}]),key:a.value_id,onClick:s=>{return t=e.attr_id,l=a.value_id,c=a.value,I[t]=l,N[t]=c,void(z.value=Object.values(N).join("，"));var t,l,c}},{default:r((()=>[d(v(a.value),1)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1}),p(t,{class:"popup-footer"},{default:r((()=>[p(t,{class:"quantity"},{default:r((()=>[p(l,null,{default:r((()=>[d("数量")])),_:1}),p(t,{class:"quantity-control"},{default:r((()=>[p(t,{class:"minus",onClick:W},{default:r((()=>[d("-")])),_:1}),p(t,{class:"count"},{default:r((()=>[d(v(P.value),1)])),_:1}),p(t,{class:"plus",onClick:V},{default:r((()=>[d("+")])),_:1})])),_:1})])),_:1}),e.showOk?(n(),i(t,{key:0,class:"confirm-ok",onClick:H},{default:r((()=>[d("确定")])),_:1})):h("",!0),p(t,{class:"confirm-btn",onClick:G},{default:r((()=>[d("加购")])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-84659ea3"]]);export{q as P,T as u};
